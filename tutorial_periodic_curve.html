<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Periodic Curve Fitting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorial_periodic_curve.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Periodic Curve Fitting</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2fitpack_2fitpack_2doc_2tutorial__periodic__curve"></a></p>
<p>This tutorial covers periodic spline fitting with <code>fitpack_periodic_curve</code>: constructing a B-spline <picture><source srcset="form_4_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ y = s(x) $" src="form_4.png"/></picture> that satisfies periodic boundary conditions, evaluating it, and computing derivatives and integrals across the period boundary.</p>
<h1><a class="anchor" id="autotoc_md85"></a>
Overview</h1>
<p>A periodic spline enforces continuity of the function and all its derivatives up to order <picture><source srcset="form_162_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k-1 $" src="form_162.png"/></picture> at the period boundary:</p>
<p class="formulaDsp">
<picture><source srcset="form_161_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    s^{(j)}(x_1) = s^{(j)}(x_m), \quad j = 0, 1, \ldots, k-1
\]" src="form_161.png"/></picture>
</p>
<p>This is the natural choice whenever the underlying signal is inherently periodic, for example:</p>
<ul>
<li><b>Cam profiles</b> and rotary-engine port timing (functions of crank angle)</li>
<li><b>Fourier-like data</b> sampled over one full period</li>
<li><b>Angular measurements</b> such as wind direction, phase angles, or azimuth</li>
</ul>
<p>The type <code>fitpack_periodic_curve</code> extends <code>fitpack_curve</code> and inherits all of its methods (<code>eval</code>, <code>dfdx</code>, <code>integral</code>, <code>zeros</code>, <code>destroy</code>, etc.). The only difference is that fitting calls the <code>percur</code> algorithm instead of <code>curfit</code>, which constructs a periodic knot vector and ties the B-spline coefficients at the boundary.</p>
<h1><a class="anchor" id="autotoc_md86"></a>
Mathematical Background</h1>
<p>Given <picture><source srcset="form_36_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m $" src="form_36.png"/></picture> data points <picture><source srcset="form_113_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (x_i, y_i) $" src="form_113.png"/></picture> with <picture><source srcset="form_275_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x_1 &lt; x_2 &lt; \cdots &lt; x_m $" src="form_275.png"/></picture>, the period is <picture><source srcset="form_276_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ P = x_m - x_1 $" src="form_276.png"/></picture>. The <code>percur</code> routine places a <b>wrapped knot vector</b>: interior knots <picture><source srcset="form_277_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ t_{k+2}, \ldots, t_{n-k-1} $" src="form_277.png"/></picture> lie inside <picture><source srcset="form_278_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ [x_1, x_m) $" src="form_278.png"/></picture>, while the boundary knots satisfy</p>
<p class="formulaDsp">
<picture><source srcset="form_279_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    t_{j} = t_{n-2k+j} - P, \quad j = 1, \ldots, k, \qquad
    t_{n-k+j} = t_{k+1+j} + P, \quad j = 1, \ldots, k
\]" src="form_279.png"/></picture>
</p>
<p>The B-spline coefficients are tied so that <picture><source srcset="form_280_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ c_{n-k-1+j} = c_j $" src="form_280.png"/></picture> for <picture><source srcset="form_281_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ j = 1, \ldots, k $" src="form_281.png"/></picture>, which guarantees that the spline and its first <picture><source srcset="form_162_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k-1 $" src="form_162.png"/></picture> derivatives are continuous across the period boundary.</p>
<p>As with <code>fitpack_curve</code>, the smoothing parameter <picture><source srcset="form_62_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ s $" src="form_62.png"/></picture> controls the trade-off between fidelity and smoothness:</p>
<p class="formulaDsp">
<picture><source srcset="form_282_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \sum_{i=1}^{m-1} \left( w_i \bigl(y_i - s(x_i)\bigr) \right)^2 \leq s
\]" src="form_282.png"/></picture>
</p>
<p>Note that the last data point <picture><source srcset="form_283_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (x_m, y_m) $" src="form_283.png"/></picture> defines the period length but is <b>not</b> included in the residual sum (only <picture><source srcset="form_284_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m-1 $" src="form_284.png"/></picture> points are fitted).</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Basic Example</h1>
<p>Fit the periodic function <picture><source srcset="form_285_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ f(x) = \cos(x) + \sin(2x) $" src="form_285.png"/></picture> on <picture><source srcset="form_286_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ [0, 2\pi] $" src="form_286.png"/></picture>. The data <b>must</b> include the right endpoint <picture><source srcset="form_287_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x_m = 2\pi $" src="form_287.png"/></picture> so that <code>percur</code> can determine the period.</p>
<div class="fragment"><div class="line"><span class="keyword">program</span> periodic_demo</div>
<div class="line">    <span class="keywordtype">use </span><a class="code hl_namespace" href="namespacefitpack.html">fitpack</a>, <span class="keywordtype">only</span>: fitpack_periodic_curve, fp_real, fp_flag, &amp;</div>
<div class="line">                       fitpack_success, fitpack_message, zero, one, half, pi</div>
<div class="line">    <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: m = 200</div>
<div class="line"><span class="keywordtype">    real</span>(FP_REAL), <span class="keywordtype">parameter</span> :: two = 2.0_fp_real</div>
<div class="line"><span class="keywordtype">    real</span>(FP_REAL), <span class="keywordtype">parameter</span> :: pi2 = two * pi</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">type</span>(fitpack_periodic_curve) :: curve</div>
<div class="line">    <span class="keywordtype">integer(FP_FLAG)</span> :: ierr</div>
<div class="line"><span class="keywordtype">    real</span>(FP_REAL) :: x(m), y(m)</div>
<div class="line">    <span class="keywordtype">integer</span> :: i</div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Generate data covering one full period [0, 2*pi]</span></div>
<div class="line">    <span class="keywordflow">do</span> i = 1, m</div>
<div class="line">        x(i) = (i - 1) * pi2 / (m - 1)</div>
<div class="line">        y(i) = cos(x(i)) + sin(two * x(i))</div>
<div class="line"><span class="keywordflow">    end do</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">! Fit with smoothing = 1</span></div>
<div class="line">    ierr = curve%new_fit(x, y, smoothing=one)</div>
<div class="line">    <span class="keywordflow">if</span> (.not. fitpack_success(ierr)) <span class="keywordflow">then</span></div>
<div class="line">        print *, <span class="stringliteral">&#39;Fit failed: &#39;</span>, fitpack_message(ierr)</div>
<div class="line">        error stop</div>
<div class="line"><span class="keywordflow">    end if</span></div>
<div class="line"> </div>
<div class="line">    print <span class="stringliteral">&#39;(a,i0)&#39;</span>,     <span class="stringliteral">&#39;Knots:    &#39;</span>, curve%knots</div>
<div class="line">    print <span class="stringliteral">&#39;(a,es10.3)&#39;</span>, <span class="stringliteral">&#39;Residual: &#39;</span>, curve%mse()</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">call </span>curve%destroy()</div>
<div class="line"><span class="keyword">end program </span>periodic_demo</div>
<div class="ttc" id="anamespacefitpack_html"><div class="ttname"><a href="namespacefitpack.html">fitpack</a></div><div class="ttdoc">Umbrella module that re-exports the complete FITPACK public API.</div><div class="ttdef"><b>Definition</b> fitpack.f90:33</div></div>
</div><!-- fragment --><p>The call to <code>curve\new_fit</code> loads the data and performs a smoothing fit in one step. Because <code>fitpack_periodic_curve</code> extends <code>fitpack_curve</code>, all evaluation and query methods work identically.</p>
<h1><a class="anchor" id="autotoc_md88"></a>
Periodicity Verification</h1>
<p>A key property of the periodic spline is that function values <b>and</b> derivatives match at the endpoints. After fitting, verify:</p>
<div class="fragment"><div class="line"><span class="keywordtype">real</span>(FP_REAL) :: y_left, y_right, dy_left, dy_right</div>
<div class="line"> </div>
<div class="line">y_left   = curve%eval(x(1), ierr)</div>
<div class="line">y_right  = curve%eval(x(m), ierr)</div>
<div class="line">dy_left  = curve%dfdx(x(1), order=1, ierr=ierr)</div>
<div class="line">dy_right = curve%dfdx(x(m), order=1, ierr=ierr)</div>
<div class="line"> </div>
<div class="line">print <span class="stringliteral">&#39;(a,f12.8)&#39;</span>, <span class="stringliteral">&#39;s(x_1)  = &#39;</span>, y_left</div>
<div class="line">print <span class="stringliteral">&#39;(a,f12.8)&#39;</span>, <span class="stringliteral">&#39;s(x_m)  = &#39;</span>, y_right</div>
<div class="line">print <span class="stringliteral">&#39;(a,f12.8)&#39;</span>, <span class="stringliteral">&quot;s&#39;(x_1) = &quot;</span>, dy_left</div>
<div class="line">print <span class="stringliteral">&#39;(a,f12.8)&#39;</span>, <span class="stringliteral">&quot;s&#39;(x_m) = &quot;</span>, dy_right</div>
</div><!-- fragment --><p>For a cubic spline ( <picture><source srcset="form_0_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k = 3 $" src="form_0.png"/></picture>), the values, first derivatives, and second derivatives all match to machine precision:</p>
<p class="formulaDsp">
<picture><source srcset="form_288_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    s(x_1) = s(x_m), \quad
    s'(x_1) = s'(x_m), \quad
    s''(x_1) = s''(x_m)
\]" src="form_288.png"/></picture>
</p>
<p>This is <b>not</b> the case for a non-periodic <code>fitpack_curve</code>, where the boundary derivatives are generally unrelated.</p>
<h1><a class="anchor" id="autotoc_md89"></a>
Integration Across the Boundary</h1>
<p>The <code>curve\integral</code> method works with periodic splines exactly as with non-periodic ones. The integration limits need not coincide with the data range. For example, integrate from <picture><source srcset="form_289_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \pi/2 $" src="form_289.png"/></picture> to <picture><source srcset="form_290_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ 3\pi $" src="form_290.png"/></picture> (which crosses the period boundary at <picture><source srcset="form_26_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ 2\pi $" src="form_26.png"/></picture>):</p>
<div class="fragment"><div class="line"><span class="keywordtype">real</span>(FP_REAL) :: area</div>
<div class="line"> </div>
<div class="line">area = curve%integral(half * pi, 3.0_fp_real * pi)</div>
<div class="line">print <span class="stringliteral">&#39;(a,f12.8)&#39;</span>, <span class="stringliteral">&#39;integral [pi/2, 3*pi] = &#39;</span>, area</div>
</div><!-- fragment --><p>For the test function <picture><source srcset="form_285_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ f(x) = \cos(x) + \sin(2x) $" src="form_285.png"/></picture> the exact integral is</p>
<p class="formulaDsp">
<picture><source srcset="form_291_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \int_{\pi/2}^{3\pi} \bigl[\cos(x) + \sin(2x)\bigr] \, dx
    = \Bigl[\sin(x) - \tfrac{1}{2}\cos(2x)\Bigr]_{\pi/2}^{3\pi}
    = -\tfrac{3}{2}
\]" src="form_291.png"/></picture>
</p>
<h1><a class="anchor" id="autotoc_md90"></a>
Smoothing and Interpolation</h1>
<p>The periodic variant supports the same fitting modes as <code>fitpack_curve</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Method   </th><th class="markdownTableHeadNone">Call   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Smoothing   </td><td class="markdownTableBodyNone"><code>curve\new_fit(x, y, smoothing=s)</code>   </td><td class="markdownTableBodyNone">Automatic knot placement with smoothing constraint    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Re-fit   </td><td class="markdownTableBodyNone"><code>curve\fit(smoothing=s)</code>   </td><td class="markdownTableBodyNone">Change smoothing on existing data    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Interpolation   </td><td class="markdownTableBodyNone"><code>curve\interpolate()</code>   </td><td class="markdownTableBodyNone">Pass through all data points ( <picture><source srcset="form_7_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ s = 0 $" src="form_7.png"/></picture>)   </td></tr>
</table>
<p>Lowering the smoothing parameter increases the number of knots and brings the spline closer to the data:</p>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span> :: i</div>
<div class="line"> </div>
<div class="line">print <span class="stringliteral">&#39;(a)&#39;</span>, <span class="stringliteral">&#39;     S       knots   residual&#39;</span></div>
<div class="line"><span class="keywordflow">do</span> i = 1, 4</div>
<div class="line">    ierr = curve%new_fit(x, y, smoothing=10.0_fp_real**(2 - i))</div>
<div class="line">    <span class="keywordflow">if</span> (fitpack_success(ierr)) <span class="keywordflow">then</span></div>
<div class="line">        print <span class="stringliteral">&#39;(es10.1,i8,es12.3)&#39;</span>, curve%smoothing, curve%knots, curve%mse()</div>
<div class="line"><span class="keywordflow">    end if</span></div>
<div class="line"><span class="keyword">end </span>do</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md91"></a>
Complete Example</h1>
<p>A self-contained program demonstrating periodic fitting, evaluation, periodicity verification, integration, interpolation, and a smoothing sweep is provided in the repository:</p>
<dl class="section see"><dt>See also</dt><dd><code>examples/example_periodic_curve.f90</code></dd>
<dd>
<a class="el" href="tutorial_curve.html">Univariate Curve Fitting with fitpack_curve</a> for the non-periodic curve tutorial </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
