<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fitpack: B-Spline Foundations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeDarkModeToggle.init()
        </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">fitpack
   </div>
   <div id="projectbrief">Modern Fortran library for curve and surface fitting with splines</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('theory_bsplines.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">B-Spline Foundations</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2fitpack_2fitpack_2doc_2theory__bsplines"></a></p>
<p>This page introduces the mathematical foundations of B-splines as used throughout FITPACK. All curve and surface fitting routines in the library represent their results as linear combinations of B-spline basis functions, so understanding these foundations is essential for interpreting knot vectors, coefficients, and the various evaluation, differentiation, and integration operations.</p>
<p>The presentation follows Dierckx (1993), Chapters 1 and 6.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Piecewise Polynomials and Knot Vectors</h1>
<p>A <b>spline</b> of degree \( k \) is a piecewise polynomial function whose pieces join with \( k - 1 \) continuous derivatives at designated breakpoints called <b>knots</b>. The knots are collected into a non-decreasing <b>knot vector</b></p>
<p class="formulaDsp">
\[    t_0 \leq t_1 \leq \cdots \leq t_{n+k+1}
\]
</p>
<p>which partitions the approximation interval \( [a, b] \) into sub-intervals. The number of distinct interior knots determines the flexibility of the spline: more knots allow closer approximation to complicated shapes, while fewer knots enforce smoothness.</p>
<p>The set of all splines of degree \( k \) on a given knot vector \( \mathbf{t} \) forms a linear space \( \mathcal{S}(k, \mathbf{t}) \) of dimension \( n + 1 \), where \( n + 1 \) is the number of B-spline basis functions (and therefore the number of coefficients needed to represent any element of the space).</p>
<p>In FITPACK the first and last \( k + 1 \) knots are clamped to the boundary:</p>
<p class="formulaDsp">
\[    t_0 = t_1 = \cdots = t_k = a, \qquad
    t_{n+1} = t_{n+2} = \cdots = t_{n+k+1} = b
\]
</p>
<p>so that the spline interpolates (rather than merely approximates) its coefficient values at the endpoints.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
B-Spline Basis Functions</h1>
<p>Every element of \( \mathcal{S}(k, \mathbf{t}) \) can be written uniquely as a linear combination of <b>B-spline basis functions</b> \( N_{i,k}(x) \), which are defined recursively by the <b>Cox&ndash;de Boor recurrence</b>.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Degree zero</h2>
<p>For \( k = 0 \) the basis functions are simple indicator functions:</p>
<p class="formulaDsp">
\[    N_{i,0}(x) =
    \begin{cases}
        1 &amp; \text{if } t_i \leq x &lt; t_{i+1}, \\
        0 &amp; \text{otherwise}.
    \end{cases}
\]
</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Recurrence for degree \( k \geq 1 \)</h2>
<p>Higher-degree basis functions are built from lower-degree ones:</p>
<p class="formulaDsp">
\[    N_{i,k}(x) =
        \frac{x - t_i}{t_{i+k} - t_i} \, N_{i,k-1}(x)
      + \frac{t_{i+k+1} - x}{t_{i+k+1} - t_{i+1}} \, N_{i+1,k-1}(x)
\]
</p>
<p>where any fraction with a zero denominator is taken to be zero (this arises when consecutive knots coincide). The routine <code>fpbspl</code> implements this recurrence.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Key properties</h2>
<p>The B-spline basis functions enjoy several properties that make them ideal for numerical computation:</p>
<ol type="1">
<li><b>Non-negativity</b>: \( N_{i,k}(x) \geq 0 \) for all \( x \).</li>
<li><b>Local support</b>: \( N_{i,k}(x) = 0 \) outside the interval \( [t_i,\, t_{i+k+1}] \). Each basis function is nonzero on at most \( k + 1 \) knot spans, so spline evaluation is a local operation.</li>
<li><b>Partition of unity</b>: At every point in \( [a, b] \) the basis functions sum to one: \( \sum_{i} N_{i,k}(x) = 1 \). This ensures that any convex combination of coefficients produces a spline value within the convex hull of those coefficients.</li>
<li><b>Smoothness</b>: At a simple knot (multiplicity 1), \( N_{i,k} \) has \( k - 1 \) continuous derivatives. Each additional coincident knot reduces smoothness by one order.</li>
</ol>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 1, &sect;1.1&ndash;1.2</dd></dl>
<h1><a class="anchor" id="autotoc_md24"></a>
Spline as a Linear Combination</h1>
<p>Any spline \( s \in \mathcal{S}(k, \mathbf{t}) \) is represented as</p>
<p class="formulaDsp">
\[    s(x) = \sum_{i=0}^{n} c_i \, N_{i,k}(x)
\]
</p>
<p>where the \( c_i \) are the <b>B-spline coefficients</b> (also called control points or de Boor points). The entire fitting problem therefore reduces to determining the \( n + 1 \) coefficients for a given knot vector.</p>
<p>In FITPACK the coefficient array is stored alongside the knot vector in each derived type (e.g., <code>fitpack_curve</code>, <code>fitpack_surface</code>). Once computed by the fitting routines, the same coefficients are used by all evaluation, derivative, and integration routines.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Evaluation: the de Boor Algorithm</h1>
<p>Given a point \( x \in [t_j,\, t_{j+1}) \), the spline value \( s(x) \) can be computed without explicitly forming all basis functions. The <b>de Boor algorithm</b> is a triangular recurrence analogous to Horner's method for ordinary polynomials.</p>
<p>Define the initial values</p>
<p class="formulaDsp">
\[    d_i^{[0]} = c_i, \qquad i = j-k, \ldots, j
\]
</p>
<p>and compute for \( r = 1, \ldots, k \):</p>
<p class="formulaDsp">
\[    d_i^{[r]} =
        \frac{x - t_i}{t_{i+k+1-r} - t_i} \, d_i^{[r-1]}
      + \frac{t_{i+k+1-r} - x}{t_{i+k+1-r} - t_i} \, d_{i-1}^{[r-1]},
    \qquad i = j-k+r, \ldots, j
\]
</p>
<p>After \( k \) stages the result is \( s(x) = d_j^{[k]} \). The cost is \( \mathcal{O}(k^2) \) per evaluation point, independent of the total number of knots. This is the core loop in <code>splev</code> and underlies every <code>eval</code> method in the library.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 1, Eq. 1.11</dd></dl>
<h1><a class="anchor" id="autotoc_md26"></a>
Derivatives</h1>
<p>Differentiation of a B-spline representation yields another B-spline of one degree lower. The derivative of \( s(x) = \sum_i c_i \, N_{i,k}(x) \) is</p>
<p class="formulaDsp">
\[    s&#39;(x) = \sum_{i=1}^{n} c_i^{(1)} \, N_{i,k-1}(x)
\]
</p>
<p>where the new coefficients are obtained by <b>differencing</b>:</p>
<p class="formulaDsp">
\[    c_i^{(1)} = \frac{k}{t_{i+k} - t_i} \, (c_i - c_{i-1})
\]
</p>
<p>Higher-order derivatives follow by repeated application: the \( \nu \)-th derivative is a spline of degree \( k - \nu \) with coefficients obtained from \( \nu \) successive differencing steps. This structure is exploited by <code>splder</code>, which computes derivatives of any order up to \( k \).</p>
<p>Because each differentiation reduces the degree by one, at most \( k \) derivatives are nonzero. A cubic spline ( \( k = 3 \)) therefore has a piecewise-constant third derivative and a zero fourth derivative, regardless of the coefficients.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 1, &sect;1.3</dd></dl>
<h1><a class="anchor" id="autotoc_md27"></a>
Integration</h1>
<p>The definite integral of a spline over an interval can be expressed directly in terms of its coefficients, without numerical quadrature. For a spline \( s(x) = \sum_i c_i \, N_{i,k}(x) \) on the interval \( [a, b] \):</p>
<p class="formulaDsp">
\[    \int_a^b s(x) \, dx = \sum_{i=0}^{n} c_i \, \frac{t_{i+k+1} - t_i}{k + 1}
\]
</p>
<p>This formula follows from the property that the integral of each basis function satisfies</p>
<p class="formulaDsp">
\[    \int_a^b N_{i,k}(x) \, dx = \frac{t_{i+k+1} - t_i}{k + 1}
\]
</p>
<p>when the knot vector is clamped at both ends. The routine <code>splint</code> implements this formula, giving exact results (up to floating-point arithmetic) regardless of the complexity of the spline.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 1, &sect;1.4</dd></dl>
<h1><a class="anchor" id="autotoc_md28"></a>
Knot Insertion (Oslo Algorithm)</h1>
<p>A fundamental operation on B-spline representations is <b>knot insertion</b>: adding a new knot \( \bar{t} \) to the knot vector without changing the spline function itself. The resulting representation has one more knot, one more coefficient, and the same function values everywhere.</p>
<p>Suppose a knot \( \bar{t} \in [t_j,\, t_{j+1}) \) is inserted. The new coefficients \( \bar{c}_i \) are obtained from the old ones by a <b>convex combination</b>:</p>
<p class="formulaDsp">
\[    \bar{c}_i =
    \begin{cases}
        c_i &amp; \text{if } i \leq j - k, \\[4pt]
        \alpha_i \, c_i + (1 - \alpha_i) \, c_{i-1}
            &amp; \text{if } j - k &lt; i \leq j, \\[4pt]
        c_{i-1} &amp; \text{if } i &gt; j,
    \end{cases}
\]
</p>
<p>with weights</p>
<p class="formulaDsp">
\[    \alpha_i = \frac{\bar{t} - t_i}{t_{i+k} - t_i}.
\]
</p>
<p>Because \( 0 \leq \alpha_i \leq 1 \), the new coefficients lie in the convex hull of their neighbours&mdash;a key property that preserves shape.</p>
<p>Knot insertion is the basis of the <b>Oslo algorithm</b> (Cohen, Lyche, and Schumaker, 1986), which generalizes the operation to insert several knots at once. In FITPACK the <code>insert</code> routine performs single knot insertion and is used both for refinement and for the zero-finding algorithm in <code>sproot</code>.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 6, &sect;6.2 (pp. 114&ndash;118)</dd></dl>
<h1><a class="anchor" id="autotoc_md29"></a>
Tensor Products for Bivariate Splines</h1>
<p>The B-spline framework extends naturally to two dimensions via <b>tensor products</b>. Given knot vectors \( \mathbf{t}_x \) and \( \mathbf{t}_y \) with associated basis functions \( N_{i,k_x}(x) \) and \( M_{j,k_y}(y) \), a bivariate spline is</p>
<p class="formulaDsp">
\[    s(x, y) = \sum_{i=0}^{n_x} \sum_{j=0}^{n_y}
        c_{ij} \, N_{i,k_x}(x) \, M_{j,k_y}(y)
\]
</p>
<p>The coefficient array \( c_{ij} \) has \( (n_x + 1)(n_y + 1) \) entries and is stored in column-major order in FITPACK.</p>
<p>Evaluation of a tensor-product spline decomposes into two sequences of univariate evaluations: first evaluate in \( x \) for each row of coefficients, then evaluate the resulting intermediate values in \( y \). This separability is the reason tensor-product splines scale well to two dimensions.</p>
<p>The routines <code>bispev</code> (grid evaluation) and <code>bispeu</code> (scattered evaluation) implement this strategy. Partial derivatives (<code>parder</code>, <code>pardeu</code>) and double integrals (<code>dblint</code>) follow the same tensor-product decomposition.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 1, &sect;1.5</dd></dl>
<h1><a class="anchor" id="autotoc_md30"></a>
Further Reading</h1>
<p>The foundations described on this page underpin all fitting algorithms in the library. The fitting problem itself&mdash;choosing knots and coefficients to approximate given data&mdash;is covered separately.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="theory_curve_fitting.html">Curve Fitting Theory</a> </dd>
<dd>
<a class="el" href="book_reference.html">Book Reference Index</a></dd></dl>
<blockquote class="doxtable">
<p>P. Dierckx, <em>Curve and Surface Fitting with Splines</em>, Oxford University Press, 1993. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
