<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Surface Fitting Theory</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('theory_surface_fitting.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Surface Fitting Theory</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2fitpack_2fitpack_2doc_2theory__surface__fitting"></a></p>
<p>This page describes the mathematical foundations for bivariate spline fitting in FITPACK: extending the one-dimensional B-spline framework to approximate surfaces <picture><source srcset="form_9_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ z = s(x, y) $" src="form_9.png"/></picture> defined over a rectangular domain.</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Tensor Product Splines</h1>
<p>A bivariate spline on the rectangular domain <picture><source srcset="form_182_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ [a, b] \times [c, d] $" src="form_182.png"/></picture> is defined as a tensor product of univariate B-splines:</p>
<p class="formulaDsp">
<picture><source srcset="form_183_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    s(x, y) = \sum_{i=1}^{n_x - k_x - 1} \sum_{j=1}^{n_y - k_y - 1}
    c_{ij} \, N_{i, k_x}(x) \, M_{j, k_y}(y)
\]" src="form_183.png"/></picture>
</p>
<p>where:</p>
<ul>
<li><picture><source srcset="form_184_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ N_{i, k_x}(x) $" src="form_184.png"/></picture> are B-splines of degree <picture><source srcset="form_185_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k_x $" src="form_185.png"/></picture> on the knot vector <picture><source srcset="form_186_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{t}_x = (t_{x,1}, \ldots, t_{x, n_x}) $" src="form_186.png"/></picture>,</li>
<li><picture><source srcset="form_187_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ M_{j, k_y}(y) $" src="form_187.png"/></picture> are B-splines of degree <picture><source srcset="form_188_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k_y $" src="form_188.png"/></picture> on the knot vector <picture><source srcset="form_189_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{t}_y = (t_{y,1}, \ldots, t_{y, n_y}) $" src="form_189.png"/></picture>,</li>
<li><picture><source srcset="form_110_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ c_{ij} $" src="form_110.png"/></picture> are the <picture><source srcset="form_190_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (n_x - k_x - 1)(n_y - k_y - 1) $" src="form_190.png"/></picture> unknown coefficients.</li>
</ul>
<p>The two knot vectors are independent: the number of knots and their placement can differ between the <picture><source srcset="form_77_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x $" src="form_77.png"/></picture>- and <picture><source srcset="form_112_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ y $" src="form_112.png"/></picture>-directions. In FITPACK, both degrees default to <picture><source srcset="form_191_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k_x = k_y = 3 $" src="form_191.png"/></picture> (bicubic).</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="theory_bsplines.html">B-Spline Foundations</a> for a detailed treatment of univariate B-spline basis functions and the de Boor&ndash;Cox recurrence.</dd></dl>
<h1><a class="anchor" id="autotoc_md38"></a>
Scattered Data Fitting (surfit)</h1>
<p>Given <picture><source srcset="form_36_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m $" src="form_36.png"/></picture> scattered observations <picture><source srcset="form_51_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (x_i, y_i, z_i) $" src="form_51.png"/></picture> with weights <picture><source srcset="form_192_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ w_i &gt; 0 $" src="form_192.png"/></picture>, the goal is to find a tensor product spline <picture><source srcset="form_193_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ s(x, y) $" src="form_193.png"/></picture> that approximates the data while remaining smooth.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
The Observation Matrix</h2>
<p>Each data point <picture><source srcset="form_113_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (x_i, y_i) $" src="form_113.png"/></picture> lies in a unique cell of the knot grid. For a given point, let <picture><source srcset="form_194_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mu $" src="form_194.png"/></picture> and <picture><source srcset="form_95_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \nu $" src="form_95.png"/></picture> index the non-zero basis functions in <picture><source srcset="form_77_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x $" src="form_77.png"/></picture> and <picture><source srcset="form_112_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ y $" src="form_112.png"/></picture>, respectively. The observation matrix <picture><source srcset="form_195_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{A} $" src="form_195.png"/></picture> has entries:</p>
<p class="formulaDsp">
<picture><source srcset="form_196_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    A_{i, \ell} = N_{\mu, k_x}(x_i) \, M_{\nu, k_y}(y_i),
    \qquad \ell = (\mu - 1)(n_y - k_y - 1) + \nu
\]" src="form_196.png"/></picture>
</p>
<p>where the two-dimensional index pair <picture><source srcset="form_197_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (\mu, \nu) $" src="form_197.png"/></picture> is mapped to a single column index <picture><source srcset="form_41_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \ell $" src="form_41.png"/></picture>. Each row of <picture><source srcset="form_195_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{A} $" src="form_195.png"/></picture> has at most <picture><source srcset="form_198_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (k_x + 1)(k_y + 1) $" src="form_198.png"/></picture> non-zero entries, so the matrix is sparse.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Least-Squares Formulation</h2>
<p>The weighted least-squares problem is:</p>
<p class="formulaDsp">
<picture><source srcset="form_199_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \min_{\mathbf{c}} \sum_{i=1}^{m} w_i^2
    \left( z_i - s(x_i, y_i) \right)^2
\]" src="form_199.png"/></picture>
</p>
<p>which in matrix form becomes  <picture><source srcset="form_200_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \min \| \mathbf{W}(\mathbf{z} -
\mathbf{A} \mathbf{c}) \|_2^2 $" src="form_200.png"/></picture> with  <picture><source srcset="form_201_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{W} =
\mathrm{diag}(w_1, \ldots, w_m) $" src="form_201.png"/></picture>.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Smoothing Formulation</h2>
<p>The smoothing spline minimizes a roughness functional subject to a data fidelity constraint:</p>
<p class="formulaDsp">
<picture><source srcset="form_202_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \min \iint \left[
        \left( \frac{\partial^2 s}{\partial x^2} \right)^2
        + 2 \left( \frac{\partial^2 s}{\partial x \, \partial y} \right)^2
        + \left( \frac{\partial^2 s}{\partial y^2} \right)^2
    \right] dx \, dy
    \quad \text{subject to} \quad
    \sum_{i=1}^{m} w_i^2 (z_i - s(x_i, y_i))^2 \leq S
\]" src="form_202.png"/></picture>
</p>
<p>where <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture> is the smoothing factor. This is the bivariate analogue of the univariate smoothing spline problem.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Rank Deficiency</h2>
<p>When few data points fall within certain cells of the knot grid, the observation matrix <picture><source srcset="form_195_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{A} $" src="form_195.png"/></picture> can become rank deficient. This is more common in the bivariate case than in one dimension, because adding knots in both directions creates cells that may contain no data at all.</p>
<p>FITPACK handles rank deficiency using Householder QR factorization with column pivoting. When the numerical rank <picture><source srcset="form_17_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ r $" src="form_17.png"/></picture> of the system is less than the number of unknowns, the algorithm computes a minimum-norm solution among all least-squares solutions.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Adaptive Knot Placement</h2>
<p>Starting from a minimal knot set, <code>surfit</code> iteratively refines the approximation:</p>
<ol type="1">
<li>Fit the current knot configuration by solving the least-squares problem.</li>
<li>If the residual sum of squares exceeds <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture>, identify regions with large residuals.</li>
<li>Insert new knots alternately in the <picture><source srcset="form_77_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x $" src="form_77.png"/></picture>- and <picture><source srcset="form_112_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ y $" src="form_112.png"/></picture>-directions, placing each knot where the local residual is largest.</li>
<li>Repeat until <picture><source srcset="form_203_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \sum w_i^2 (z_i - s(x_i, y_i))^2 \leq S $" src="form_203.png"/></picture> is satisfied or a maximum knot count is reached.</li>
</ol>
<p>The alternating strategy ensures balanced refinement across both coordinate directions.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 5, &sect;5.3 (pp. 85&ndash;98)</dd></dl>
<h1><a class="anchor" id="autotoc_md44"></a>
Gridded Data Fitting (regrid)</h1>
<p>When the data lie on a rectangular grid <picture><source srcset="form_204_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ z_{ji} = z(y_j, x_i) $" src="form_204.png"/></picture> with <picture><source srcset="form_12_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ i = 1, \ldots, m_x $" src="form_12.png"/></picture> and <picture><source srcset="form_14_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ j = 1, \ldots, m_y $" src="form_14.png"/></picture>, the problem has a Kronecker product structure that can be exploited for dramatic computational savings.</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Kronecker Product Structure</h2>
<p>On a grid, the observation matrix factors as a Kronecker product:</p>
<p class="formulaDsp">
<picture><source srcset="form_205_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \mathbf{A}_{\text{grid}} = \mathbf{B}_x \otimes \mathbf{B}_y
\]" src="form_205.png"/></picture>
</p>
<p>where <picture><source srcset="form_206_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{B}_x $" src="form_206.png"/></picture> is the <picture><source srcset="form_207_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m_x \times (n_x - k_x - 1) $" src="form_207.png"/></picture> matrix of univariate B-spline values at the <picture><source srcset="form_77_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ x $" src="form_77.png"/></picture>-grid points, and <picture><source srcset="form_208_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{B}_y $" src="form_208.png"/></picture> is the <picture><source srcset="form_209_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m_y \times (n_y - k_y - 1) $" src="form_209.png"/></picture> matrix at the <picture><source srcset="form_112_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ y $" src="form_112.png"/></picture>-grid points. The coefficient matrix conceptually satisfies:</p>
<p class="formulaDsp">
<picture><source srcset="form_210_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    \mathbf{C} = \mathbf{B}_x^{-1} \, \mathbf{Z} \, (\mathbf{B}_y^T)^{-1}
\]" src="form_210.png"/></picture>
</p>
<p>where <picture><source srcset="form_211_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{Z} $" src="form_211.png"/></picture> is the <picture><source srcset="form_212_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m_x \times m_y $" src="form_212.png"/></picture> matrix of observed values and <picture><source srcset="form_213_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{C} $" src="form_213.png"/></picture> holds the spline coefficients.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Computational Advantage</h2>
<p>The factored form means the normal equations can be solved dimension by dimension rather than simultaneously:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Approach   </th><th class="markdownTableHeadNone">Complexity    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scattered (<code>surfit</code>)   </td><td class="markdownTableBodyNone"><picture><source srcset="form_214_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathcal{O}(m \cdot n_x \cdot n_y) $" src="form_214.png"/></picture>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gridded (<code>regrid</code>)   </td><td class="markdownTableBodyNone"><picture><source srcset="form_215_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathcal{O}(m_x \cdot m_y \cdot (k_x + k_y)) $" src="form_215.png"/></picture>   </td></tr>
</table>
<p>For a 100 x 100 grid with 20 knots in each direction, the gridded approach is roughly two orders of magnitude faster. <b>Always prefer <code>fitpack_grid_surface</code> when data lie on a rectangular grid.</b></p>
<p>The smoothing framework (roughness minimization subject to a fidelity constraint) is identical to the scattered case; only the numerical solution method differs.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 5, &sect;5.4 (pp. 98&ndash;103)</dd></dl>
<h1><a class="anchor" id="autotoc_md47"></a>
The Smoothing Norm</h1>
<p>For bivariate splines, the roughness measure used in the smoothing formulation is the thin-plate energy functional:</p>
<p class="formulaDsp">
<picture><source srcset="form_216_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    R[s] = \iint \left[
        \left( \frac{\partial^2 s}{\partial x^2} \right)^2
        + 2 \left( \frac{\partial^2 s}{\partial x \, \partial y} \right)^2
        + \left( \frac{\partial^2 s}{\partial y^2} \right)^2
    \right] dx \, dy
\]" src="form_216.png"/></picture>
</p>
<p>This is the natural extension of <picture><source srcset="form_217_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \int (s'')^2 \, dx $" src="form_217.png"/></picture> to two dimensions. It penalizes curvature equally in all directions and is invariant under rotation of the coordinate axes. The cross-derivative term <picture><source srcset="form_218_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (\partial^2 s / \partial x \, \partial y)^2 $" src="form_218.png"/></picture> ensures that diagonal oscillations are penalized as well.</p>
<p>For a tensor product spline, this integral can be expressed as a quadratic form in the coefficients <picture><source srcset="form_110_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ c_{ij} $" src="form_110.png"/></picture>, involving integrals of products of B-spline second derivatives. FITPACK computes these integrals analytically using the knot vectors.</p>
<h1><a class="anchor" id="autotoc_md48"></a>
Choosing the Smoothing Factor</h1>
<p>The smoothing factor <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture> controls the balance between fidelity and smoothness:</p>
<ul>
<li>** <picture><source srcset="form_143_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S = 0 $" src="form_143.png"/></picture>**: Interpolation. The spline passes through every data point (requires enough knots to satisfy the interpolation conditions).</li>
<li>**Small <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture>**: Close fit to the data, but the surface may exhibit spurious oscillations.</li>
<li>**Large <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture>**: Very smooth surface that may underfit the data.</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
Practical Guidelines</h2>
<p>For <b>scattered data</b> with unit weights ( <picture><source srcset="form_155_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ w_i = 1 $" src="form_155.png"/></picture>), a reasonable starting point is:</p>
<p class="formulaDsp">
<picture><source srcset="form_219_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    S \approx m
\]" src="form_219.png"/></picture>
</p>
<p>where <picture><source srcset="form_36_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ m $" src="form_36.png"/></picture> is the number of data points. This follows from the expectation that, for a good fit with normally distributed residuals, the sum of squared residuals should be <picture><source srcset="form_220_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathcal{O}(m) $" src="form_220.png"/></picture>.</p>
<p>For <b>gridded data</b> with unit weights, the analogous rule is:</p>
<p class="formulaDsp">
<picture><source srcset="form_221_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    S \approx m_x \cdot m_y
\]" src="form_221.png"/></picture>
</p>
<p>After fitting, inspect the mean squared error via the <code>mse()</code> method to assess fit quality. If the residual is too large, decrease <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture>; if the surface oscillates, increase <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture>.</p>
<p>When data have non-unit weights, interpret <picture><source srcset="form_144_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S $" src="form_144.png"/></picture> relative to the weighted residual. Setting <picture><source srcset="form_222_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ w_i = 1 / \sigma_i $" src="form_222.png"/></picture> (where <picture><source srcset="form_223_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \sigma_i $" src="form_223.png"/></picture> is the measurement standard deviation) makes the residual sum an approximate <picture><source srcset="form_224_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \chi^2 $" src="form_224.png"/></picture> statistic, and <picture><source srcset="form_225_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ S \approx m $" src="form_225.png"/></picture> corresponds to a reduced <picture><source srcset="form_224_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \chi^2 $" src="form_224.png"/></picture> of unity.</p>
<h1><a class="anchor" id="autotoc_md50"></a>
Parametric Surfaces</h1>
<p>For surfaces embedded in <picture><source srcset="form_30_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbb{R}^d $" src="form_30.png"/></picture> and parameterized by <picture><source srcset="form_43_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (u, v) $" src="form_43.png"/></picture>, each coordinate component is represented as a separate bivariate spline sharing common knot vectors:</p>
<p class="formulaDsp">
<picture><source srcset="form_226_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaDsp" alt="\[    s_l(u, v) = \sum_{i=1}^{n_u - k_u - 1} \sum_{j=1}^{n_v - k_v - 1}
    c_{ij}^{(l)} \, N_{i, k_u}(u) \, M_{j, k_v}(v),
    \qquad l = 1, \ldots, d
\]" src="form_226.png"/></picture>
</p>
<p>All <picture><source srcset="form_31_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ d $" src="form_31.png"/></picture> components share the same knot vectors <picture><source srcset="form_227_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{t}_u $" src="form_227.png"/></picture> and <picture><source srcset="form_228_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{t}_v $" src="form_228.png"/></picture>, and the same spline degrees <picture><source srcset="form_229_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k_u $" src="form_229.png"/></picture> and <picture><source srcset="form_230_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ k_v $" src="form_230.png"/></picture>. Only the coefficient arrays <picture><source srcset="form_231_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ c_{ij}^{(l)} $" src="form_231.png"/></picture> differ between components.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Periodicity</h2>
<p>Either parameter direction (or both) may be periodic:</p>
<ul>
<li>**Periodic in <picture><source srcset="form_34_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ u $" src="form_34.png"/></picture>**: enforces <picture><source srcset="form_232_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ s_l^{(p)}(u_{\min}, v) = s_l^{(p)}(u_{\max}, v) $" src="form_232.png"/></picture> for <picture><source srcset="form_233_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ p = 0, 1, \ldots, k_u - 1 $" src="form_233.png"/></picture>.</li>
<li>**Periodic in <picture><source srcset="form_46_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ v $" src="form_46.png"/></picture>**: enforces <picture><source srcset="form_234_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ s_l^{(p)}(u, v_{\min}) = s_l^{(p)}(u, v_{\max}) $" src="form_234.png"/></picture> for <picture><source srcset="form_235_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ p = 0, 1, \ldots, k_v - 1 $" src="form_235.png"/></picture>.</li>
</ul>
<p>Periodicity is useful for closed surfaces such as cylinders and tori. The FITPACK routine <code>parsur</code> handles the general case.</p>
<dl class="section see"><dt>See also</dt><dd>Dierckx, Ch. 10, &sect;10.2 (pp. 241&ndash;254)</dd></dl>
<h1><a class="anchor" id="autotoc_md52"></a>
Summary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Problem   </th><th class="markdownTableHeadNone">FITPACK Type   </th><th class="markdownTableHeadNone">Core Routine   </th><th class="markdownTableHeadNone">Key Advantage    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scattered <picture><source srcset="form_51_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ (x_i, y_i, z_i) $" src="form_51.png"/></picture>   </td><td class="markdownTableBodyNone"><code>fitpack_surface</code>   </td><td class="markdownTableBodyNone"><code>surfit</code>   </td><td class="markdownTableBodyNone">Handles arbitrary point distributions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gridded <picture><source srcset="form_236_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ z(y_j, x_i) $" src="form_236.png"/></picture>   </td><td class="markdownTableBodyNone"><code>fitpack_grid_surface</code>   </td><td class="markdownTableBodyNone"><code>regrid</code>   </td><td class="markdownTableBodyNone">Kronecker structure, much faster    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Parametric <picture><source srcset="form_237_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbf{r}(u, v) $" src="form_237.png"/></picture>   </td><td class="markdownTableBodyNone"><code>fitpack_parametric_surface</code>   </td><td class="markdownTableBodyNone"><code>parsur</code>   </td><td class="markdownTableBodyNone">Surfaces in <picture><source srcset="form_30_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ \mathbb{R}^d $" src="form_30.png"/></picture>   </td></tr>
</table>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="tutorial_surface.html">Scattered Surface Fitting Tutorial</a> for code examples and practical usage </dd>
<dd>
<a class="el" href="tutorial_polar.html">Polar Domain Fitting Tutorial</a> for polar and spherical domain fitting </dd>
<dd>
<a class="el" href="book_reference.html">Book Reference Index</a> for a complete mapping of routines to book chapters </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
